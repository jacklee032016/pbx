# $Id: README,v 1.2 2007/08/10 20:14:17 lizhijie Exp $

                  README for STC Analog PBX project
                           Li Zhijie 2007.07.30

2007.08.10
    呼叫层的定时单位：
        100ms，设置为500ms时响应太慢
        最大25.6秒，需要用timeoutcount
        需要实现的定时：
        	IP录音的定时      ：20秒
            录音时间的定时    ：10秒
            路由播放的定时    ：10秒
            自检的定时        ：10秒
            忙音的定时        ：20秒
            拨号的超时        ：20秒
            检测CAR信号的超时 ：2秒
            CAR总延迟的超时   ：6秒
            回铃音的超时      ：50秒
            振铃的超时        ：50秒
            离位转移的超时    ：小于振铃的超时
       所以RINGING和TRYING状态需要对超时次数计数
            单次延迟10秒，超时6次，总共延迟60秒
       另外：还需要对超时次数计数的是IDLE状态
            
            
    设备层的定时单位：
        50ms
        最大1.28秒，可以满足设备层的定时需要


新的程序框架
                            ______________
                            |Call  Device|
                            --------------
                              -/|    \
                              /      \
                              \      /
                               \   |/-
 _____________             ________________           _____________
 | ExtDevice |             | PSTN  Device |           | IP Device |
 -------------             ----------------           -------------
                                  / \
                                   | 
                                   |
                                  \ /
                          _______________________
                          |    HAL Layer        |
                          -----------------------
                                   / \
                                    | 
                                    |
                                   \ /
                         ___________________________
                         |Hardware Interface Layer |
                         --------------------------- 

1. 呼叫层只处理呼叫事件和呼叫的超时，不处理设备的超时
   呼叫事件：由设备发出的硬件事件，例如摘挂机、ringer ON/OFF
   呼叫的超时：例如振铃久叫不应的时间，而不是设备的超时例如tone和振铃的超时
   
   呼叫层向设备层发出控制命令，控制设备的超时，例如控制设备振铃、停止振铃等

2. 设备层
   分为分机、外线、IP等三类设备
   每周设备完成两个任务：
       监控该设备的状态，并向呼叫层发出设备事件
       处理呼叫层发来的控制命令

3. 硬件抽象层（HAL）
    屏蔽硬件层的物理细节，提供抽象的硬件接口

4. 硬件接口层
    与具体的物理层交换，真正实现设备监控和设备操作
        