# $Id: ChangeLog,v 1.30 2007/07/25 17:32:41 lizhijie Exp $
         ChangeLog for Analog PBX based on STC
                        Li Zhijie 2007.04.08

2007.07.23
    解决录音不能立即生效、放音不能多次播放的问题
        由于编程状态的退出操作没有执行的原因，造成了REC、PLAY管脚的低电平没有设置成功
                        
2007.07.22
    使用新的硬件接口程序框架，并全部基本调试通过
    增加串口调试的程序框架，以完整地调试呼叫的流程和各个命令
    data=136.4 xdata=893 code=23926

                        
2007.07.07
    实现基于sm8823芯片的中国制式的来电显示
     data=146.3 xdata=877 code=23753
    
2007.07.04
    增加基于铃流检测和定时器两种方式的来电检测
    实际只能使用定时器方式

2007.07.03
	修改外线的来电检测
	    使其可以检测日本信令格式的有无CAR信号
	    可以兼容中国和日本制式的外线接口（CallerId因为芯片的关系不能解析）
	    减少了振铃过程中，取消操作的延迟
    调试修改话机编程的bug
    data=146.3 xdata=881 code=23905

2007.07.02
    调试并测试全部的话机编程命令及其相关的网管操作

2007.06.30
    增加并完善外线呼入的功能
        虚拟总机和直拨模式的正确操作
        外线群呼时，虚拟总机的群呼
        
    优化代码
        读取FSK CallerID的中断程序的register Bank
            中断程序造成的外线定时的代码操作结果不稳定的问题
        蜂鸣器的代码
        定时读取摘机事件等，除DTMF号码解析外，均在定时任务中读取
    代码结果
    data=147.3 xdata=871 code=23131

2007.06.29
    增加电话会议的程序框架和基本功能调试
     data=157.3 xdata=879 code=22496

2007.06.28
    不能有两个分机同时处于编程状态
    增加呼叫等待/保持的程序框架和基本功能
    data=157.3 xdata=875 code=21345

2007.06.27
    为呼叫等待等重新修改了程序的框架和结构，主要有：
        增加wait状态用于代拨、转接、三方通话、呼叫等待和电话会议
        修改了分机的ONHOOK和Flash事件的检测框架
    已实现的功能：代拨、转接和三方通话    
    data=157.3 xdata=867 code=20596    

2007.06.24
    实现全部的话机编程程序，包括查询号码的操作，增加状态RERING，用于话机号码查询
    调试话机编程的主要命令，
    data=157.3 xdata=867 code=19191
                        
2007.06.22
    完成完整的话机编程框架，并实现基本的话机编程功能
    将串口和话机编程的数据保存接口进行了统一
    data=159.3 xdata=867 code=17859

2007.06.21
    增加自检的程序和功能
    data=155.3 xdata=867 code=17362
                        
2006.06.19
    增加话机编程的程序框架：增加一个状态及其函数调用结构
    实现话机的录音和播放操作
    
    解决IP拨打话机时，取消后造成的暂时不能拨号的问题：在IDLE状态中判断是否
    需要响应的IP侧发来的OffHook事件
    
    增加PBX对IP录音的响应功能，并实现IP的录音
        data=155.3 xdata=867 code=16069
 
2007.06.18
    解决IP侧多次在呼叫中主动停止造成的没有释放IP通道的问题

2007.05.19
    增加基于FM24C08 EEPROM的数据存储、访问接口
    完成对全部数据的存储和访问
    修改程序的启动流程

2007.05.16
    实现全部的基于串口的网管功能，并与IP侧的程序调试成功

2007.05.15
	6种模式的拨打完全正确
	完成基本的网管配置接口，并可以配置特服和分机号码等注意信息
	二进制文件大小：15273
	    data区：158.3
	    xdata区：907
	    code区：15272
	
2005.07.14
    解决分机停止振铃操作中，因为标志设置不准确造成的第二次振铃时不能停止的问题
    解决外线呼入时，拨号音不正确的问题
    重新优化状态机代码的结构
    外出6种呼叫中，除IP-->PSTN的情况，并基本调试稳定

2007.05.13
    调试IP呼叫外线的程序
    增加外线挂机的延迟操作，保证外线挂机时的脉冲不会被错误地检测为下一个外线来电的信号
    

2007.05.12
    增加IP呼叫外线的程序框架
    修改IP侧的软件，解决现有bug


2007.05.11
	增加呼叫转移的程序框架，并实现
	    转移到分机
	    转移到IP（一次发出多位的号码到IP端）
    实现呼叫转移到PSTN外线
    重新定义DTMF编码信道的使用（分机的来电显示和外线的自动拨号）

2007.05.10
    完整的支持六种呼叫的、统一的状态机框架
    许多小bug和功能增强
    调试IP呼叫PSTN外线的方式

2007.05.09
	增加电话制式参数的数据结构和使用

2007.05.07
    完成双向的PBX <--> IP的呼叫流程
    修改信道分配、播放回铃音和音乐的函数
    解决呼通后，出现杂音的问题
    代码大小：
        二进制文件：13897
        data区：156.3
        xdata区：927
        code区：13895
        

2007.05.04
    增加配置数据内存中的数据结构
    出厂默认配置的框架重新修改，使用结构数据的方式
    默认数据和配置数据在串口的发送和IP侧的解析调试成功：准确且成功配置数据
    调试串口的收发（中断和主程序的互斥）
    可以向IP发出呼叫信息

2007.05.02
    创建CVS仓储as600_StcPbx，以被其他模块引用：应用的模块为
        as600_SharedLib
        as600_WebAdmin
        as600_Pbx

2007.05.01
    重新规整了串口的命令字：
        收和发使用同样的命令字
        同样功能（配置管理功能）的打开和关闭操作使用同一个命令字，用不同的数据值来区别
            IP一侧的关闭操作使用的值为0XFE，这样与命令的结束标志0XFF区别开来        
        需要统一呼叫控制的命令字
    简化了串口程序的流程
    增加串口的接受和发送功能，并且可以使用串口程序更新STC的系统
    可以发送串口的配置数据

2007.04.28
    增加uart接收消息的程序
    增加hex2bin.exe程序
    可以从IXP42X上通过软件上传程序到PBX上

2007.04.24
    外线作为被叫的流程基本可以使用

2007.04.23
    修改start.a51中的栈空间大小的定义
    修改link脚本，建立状态机函数转换表的overlay关系
    现有功能稳定正确地运行
    修改外线被叫时，检测振铃的逻辑

2007.04.22
    完成并测试分机之间的来电显示
    完成3位的电话号码，可以拨号“*1”或“801”两种方式的号码
    外线呼叫的主叫方流程


2007.04.08
    完成基本的分机之间的呼叫流程，并支持分机号和‘×’起始的两种拨号模式
    
                        